# Claude-Mem 新搜索功能说明

## 概述

Claude-Mem 项目新增了多种强大的搜索功能，用户可以通过 http://localhost:37777/ 页面访问这些功能。这些功能包括时间线搜索、决策搜索、变更搜索等，让用户能够更精确地查找和回顾项目历史。

## 新增搜索类型

### 1. 🔍 标准搜索 (Standard Search)
- **端点**: `/api/search`
- **功能**: 统一的搜索接口，可以搜索观察结果、会话和提示
- **参数**: `query`, `type`, `limit`, `project`

### 2. 📅 时间线搜索 (Timeline Search)
- **端点**: `/api/timeline`
- **功能**: 搜索包含时间线信息的观察结果，按时间顺序展示
- **使用场景**: 查找项目的开发时间线、里程碑事件
- **示例查询**: "重构", "部署", "功能开发"

### 3. 💡 决策搜索 (Decisions Search)
- **端点**: `/api/decisions`
- **功能**: 专门搜索决策相关的观察结果
- **使用场景**: 查找架构决策、技术选型、重要决定
- **示例查询**: "架构选择", "技术栈", "设计决策"

### 4. 🔄 变更搜索 (Changes Search)
- **端点**: `/api/changes`
- **功能**: 搜索变更相关的观察结果和概念
- **使用场景**: 查找代码修改、功能变更、bug修复
- **示例查询**: "修改", "修复", "更新", "变更"

### 5. ⚙️ 工作原理搜索 (How It Works)
- **端点**: `/api/how-it-works`
- **功能**: 搜索"如何工作"相关的解释性观察结果
- **使用场景**: 查找系统架构说明、工作原理、技术文档
- **示例查询**: "架构", "实现原理", "工作流程"

### 6. 🏷️ 按概念搜索 (By Concept)
- **端点**: `/api/search/by-concept`
- **功能**: 按概念标签搜索观察结果
- **使用场景**: 按特定概念分类查找内容
- **参数**: `concept`, `limit`
- **示例查询**: "重构", "测试", "部署"

### 7. 📄 按文件搜索 (By File)
- **端点**: `/api/search/by-file`
- **功能**: 按文件路径搜索相关的观察结果
- **使用场景**: 查找特定文件的修改历史、相关讨论
- **参数**: `filePath`, `limit`
- **示例查询**: "src/components/", "package.json", "README.md"

### 8. 🏷️ 按类型搜索 (By Type)
- **端点**: `/api/search/by-type`
- **功能**: 按观察类型搜索结果
- **使用场景**: 按类型过滤观察结果
- **参数**: `type`, `limit`
- **示例查询**: "decision", "change", "discovery", "bugfix"

## 界面使用方法

### 访问主界面
1. 打开浏览器，访问 `http://localhost:37777/`
2. 在页面顶部的搜索区域可以看到新的搜索类型选择器

### 使用搜索功能
1. **选择搜索类型**: 在搜索类型下拉菜单中选择所需的搜索类型
2. **输入查询关键词**: 根据选择的搜索类型，在相应的输入框中输入关键词
3. **执行搜索**: 点击搜索或按回车键执行搜索
4. **查看结果**: 搜索结果会显示在主内容区域

### 搜索类型说明

| 图标 | 类型 | 描述 | 适用场景 |
|------|------|------|----------|
| 🔍 | 标准搜索 | 通用搜索接口 | 快速查找任何内容 |
| 📅 | 时间线搜索 | 按时间顺序查找事件 | 项目开发历程 |
| 💡 | 决策搜索 | 查找决策相关内容 | 技术选型、架构决策 |
| 🔄 | 变更搜索 | 查找修改和更新 | 代码变更、功能更新 |
| ⚙️ | 工作原理 | 查找技术说明 | 架构文档、实现原理 |
| 🏷️ | 按概念搜索 | 按标签分类查找 | 按概念组织的内容 |
| 📄 | 按文件搜索 | 查找文件相关内容 | 文件修改历史 |
| 🏷️ | 按类型搜索 | 按类型过滤查找 | 按观察类型分类 |

## API 使用示例

### 时间线搜索
```bash
curl "http://localhost:37777/api/timeline?query=重构&limit=10"
```

### 决策搜索
```bash
curl "http://localhost:37777/api/decisions?limit=10"
```

### 按概念搜索
```bash
curl "http://localhost:37777/api/search/by-concept?concept=重构&limit=10"
```

### 按文件搜索
```bash
curl "http://localhost:37777/api/search/by-file?filePath=src/&limit=10"
```

### 按类型搜索
```bash
curl "http://localhost:37777/api/search/by-type?type=decision&limit=10"
```

## 技术实现

### 前端实现
- **新增组件**: 在 Header 组件中添加搜索类型选择器
- **新增 Hook**: `useSearchTypes` 用于处理不同搜索类型的 API 调用
- **状态管理**: 在 App 组件中集成了搜索结果状态管理

### 后端 API
- **搜索路由**: `SearchRoutes.ts` 中定义了所有新的搜索端点
- **搜索管理器**: `SearchManager.ts` 实现了具体的搜索逻辑
- **向量搜索**: 集成了 Chroma 向量数据库进行语义搜索

### 搜索特性
- **混合搜索**: 结合关键词搜索和向量语义搜索
- **结果排序**: 根据相关性和时间进行智能排序
- **错误处理**: 完善的错误处理和降级机制
- **缓存优化**: 搜索结果缓存提升响应速度

## 使用建议

### 最佳实践
1. **精确查询**: 使用具体的关键词获得更准确的搜索结果
2. **组合搜索**: 可以结合不同的搜索类型获得全面信息
3. **限制结果**: 使用 `limit` 参数控制返回结果数量
4. **项目过滤**: 使用 `project` 参数限制搜索范围

### 搜索技巧
- **时间线搜索**: 适合查找项目发展的完整历程
- **决策搜索**: 用于回溯重要的技术决策和选型过程
- **变更搜索**: 快速定位代码修改和功能更新
- **按文件搜索**: 追踪特定文件的修改历史

## 故障排除

### 常见问题
1. **搜索无结果**: 尝试使用不同的关键词或减少限制条件
2. **API 错误**: 检查 worker 服务是否正常运行
3. **界面异常**: 刷新页面或清除浏览器缓存

### 调试工具
- **测试页面**: 访问 `search-demo.html` 测试各种搜索功能
- **API 文档**: 所有搜索端点都有详细的帮助信息
- **日志查看**: worker 服务日志包含详细的搜索操作信息

## 未来规划

### 计划中的功能
1. **高级过滤器**: 添加日期范围、项目标签等过滤条件
2. **搜索建议**: 智能搜索建议和自动补全
3. **搜索历史**: 保存和管理搜索历史记录
4. **导出功能**: 将搜索结果导出为不同格式

### 性能优化
1. **搜索缓存**: 实现更智能的搜索结果缓存
2. **分页优化**: 大结果集的分页加载优化
3. **实时搜索**: 实现搜索建议的实时更新

---

**注意**: 确保 worker 服务正在运行才能使用这些搜索功能。可以通过 `node plugin/scripts/worker-cli.js status` 检查服务状态。
